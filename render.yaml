# Render Blueprint - Infrastructure as Code
# https://render.com/docs/blueprint-spec

services:
  # Dashboard and API Web Service
  - type: web
    name: aleph-dashboard
    env: node
    region: oregon
    plan: starter
    buildCommand: npm ci --production
    startCommand: node api/server.js
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: JOBS_API_PORT
        value: 8080
      - key: SENTRY_DSN
        sync: false  # Set in Render dashboard
      - key: REDIS_HOST
        fromService:
          type: redis
          name: aleph-redis
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: aleph-redis
          property: port

  # Background Worker (Optional)
  - type: worker
    name: aleph-worker
    env: node
    region: oregon
    plan: starter
    buildCommand: npm ci --production
    startCommand: node pipelines/duplicate-detection-pipeline.js
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: SENTRY_DSN
        sync: false

# Redis Cache
databases:
  - name: aleph-redis
    plan: starter
    region: oregon
    ipAllowList: []  # Allow access from all Render services
