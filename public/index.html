<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlephAuto Dashboard - Pipeline Monitoring</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">âš¡ AlephAuto Dashboard</h1>
                <p class="header-subtitle">Pipeline Monitoring & Job Queue Management</p>
            </div>
            <div class="header-right">
                <div class="system-status" id="systemStatus">
                    <span class="status-indicator status-connecting" role="img" aria-label="Status: Connecting..."></span>
                    <span class="status-text">Connecting...</span>
                </div>
                <div class="doppler-health" id="dopplerHealth">
                    <span class="health-indicator health-checking" role="img" aria-label="Doppler: Checking..."></span>
                    <span class="health-text">Doppler: Checking...</span>
                </div>
                <div class="last-update" id="lastUpdate">
                    <span class="update-label">Last update:</span>
                    <span class="update-time">--:--:--</span>
                </div>
            </div>        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="dashboard">
        <!-- Pipeline Status Section -->
        <section class="dashboard-section pipelines-section">
            <h2 class="section-title">ğŸ“Š Pipeline Status</h2>
            <div class="pipeline-cards" id="pipelineCards">
                <!-- Pipeline cards will be dynamically inserted here -->
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading pipelines...</p>
                </div>
            </div>
        </section>

        <!-- Job Queue Section -->
        <section class="dashboard-section queue-section">
            <h2 class="section-title">ğŸ“‹ Job Queue</h2>
            <div class="queue-content">
                <div class="queue-stats" id="queueStats">
                    <div class="stat-card">
                        <span class="stat-label">Active</span>
                        <span class="stat-value" id="activeJobsCount">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Queued</span>
                        <span class="stat-value" id="queuedJobsCount">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Capacity</span>
                        <span class="stat-value" id="capacityValue">0%</span>
                    </div>
                </div>
                <div class="queue-jobs" id="queueJobs">
                    <p class="empty-state">No active or queued jobs</p>
                </div>
            </div>
        </section>

        <!-- Retry Queue Section -->
        <section class="dashboard-section retry-section">
            <h2 class="section-title">ğŸ”„ Retry Queue</h2>
            <div class="retry-content">
                <div class="retry-stats" id="retryStats">
                    <div class="stat-card">
                        <span class="stat-label">Active Retries</span>
                        <span class="stat-value" id="activeRetriesCount">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Attempts</span>
                        <span class="stat-value" id="totalRetryAttempts">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Nearing Limit</span>
                        <span class="stat-value warning" id="nearingLimitCount">0</span>
                    </div>
                </div>
                <div class="retry-distribution" id="retryDistribution">
                    <h3 class="subsection-title">Retry Distribution</h3>
                    <div class="distribution-bars">
                        <div class="distribution-bar">
                            <div class="bar-label">Attempt 1</div>
                            <div class="bar-container">
                                <div class="bar-fill" id="attempt1Bar" style="width: 0%"></div>
                                <span class="bar-value" id="attempt1Value">0</span>
                            </div>
                        </div>
                        <div class="distribution-bar">
                            <div class="bar-label">Attempt 2</div>
                            <div class="bar-container">
                                <div class="bar-fill" id="attempt2Bar" style="width: 0%"></div>
                                <span class="bar-value" id="attempt2Value">0</span>
                            </div>
                        </div>
                        <div class="distribution-bar">
                            <div class="bar-label">Attempt 3+</div>
                            <div class="bar-container">
                                <div class="bar-fill warning" id="attempt3PlusBar" style="width: 0%"></div>
                                <span class="bar-value" id="attempt3PlusValue">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="retry-jobs" id="retryJobs">
                    <h3 class="subsection-title">Jobs Being Retried</h3>
                    <div id="retryJobsList">
                        <p class="empty-state">No jobs currently being retried</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activity Feed Section -->
        <section class="dashboard-section activity-section">
            <h2 class="section-title">ğŸ“ Recent Activity</h2>
            <div class="activity-feed" id="activityFeed">
                <p class="empty-state">No recent activity</p>
            </div>
        </section>
    </main>

    <!-- Documentation Section -->
    <section class="documentation-section">
        <div class="documentation-header">
            <h2 class="section-title">ğŸ“š Documentation</h2>
            <div class="doc-tabs" id="docTabs">
                <button class="doc-tab active" data-doc="getting-started">Getting Started</button>
                <button class="doc-tab" data-doc="pipelines">Pipelines</button>
                <button class="doc-tab" data-doc="api">API Reference</button>
                <button class="doc-tab" data-doc="architecture">Architecture</button>
            </div>
        </div>
        <div class="documentation-content" id="docContent">
            <div class="doc-panel active" data-panel="getting-started">
                <h3>Getting Started with AlephAuto</h3>
                <p>AlephAuto is a job queue framework for automation pipelines. This dashboard provides real-time monitoring of:</p>
                <ul>
                    <li><strong>Pipeline Status:</strong> Track all active pipelines and their health</li>
                    <li><strong>Job Queue:</strong> Monitor active and queued jobs with capacity tracking</li>
                    <li><strong>Real-time Updates:</strong> WebSocket connection provides live status updates</li>
                    <li><strong>Activity Feed:</strong> Recent events, completions, and errors</li>
                </ul>
                <h4>Quick Actions</h4>
                <ul>
                    <li>View pipeline details by clicking on any pipeline card</li>
                    <li>Check job queue capacity and active jobs</li>
                    <li>Monitor recent activity in the activity feed</li>
                    <li>Switch documentation tabs for detailed information</li>
                </ul>
            </div>
            <div class="doc-panel" data-panel="pipelines">
                <h3>Available Pipelines</h3>
                <div class="pipeline-docs">
                    <div class="pipeline-doc">
                        <h4>ğŸ” Duplicate Detection Pipeline</h4>
                        <p><strong>Purpose:</strong> Scans repositories for duplicate code using AST-grep and similarity algorithms</p>
                        <p><strong>Schedule:</strong> Daily at 2 AM (configurable via CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>7-stage processing pipeline (JS â†’ Python)</li>
                            <li>Multi-layer similarity detection</li>
                            <li>Redis caching with Git commit-based invalidation</li>
                            <li>HTML/JSON/Markdown report generation</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ“„ Documentation Enhancement Pipeline</h4>
                        <p><strong>Purpose:</strong> Injects Schema.org structured data into README files</p>
                        <p><strong>Schedule:</strong> Daily at 3 AM (DOC_CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Automatic Schema.org JSON-LD generation</li>
                            <li>SEO impact scoring</li>
                            <li>Batch processing with dry-run mode</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ“Š Git Activity Pipeline</h4>
                        <p><strong>Purpose:</strong> Generates weekly/monthly git activity reports</p>
                        <p><strong>Schedule:</strong> Sunday at 8 PM (GIT_CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Commit statistics and visualizations</li>
                            <li>Author contribution tracking</li>
                            <li>Markdown report generation</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ”Œ Plugin Management Pipeline</h4>
                        <p><strong>Purpose:</strong> Audits Claude Code plugins for duplicates and issues</p>
                        <p><strong>Schedule:</strong> Monday at 9 AM (PLUGIN_CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Duplicate plugin detection</li>
                            <li>Version conflict identification</li>
                            <li>Cleanup recommendations</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ“ Gitignore Management Pipeline</h4>
                        <p><strong>Purpose:</strong> Batch updates .gitignore files across repositories with repomix-output.xml entry</p>
                        <p><strong>Schedule:</strong> Daily at 4 AM (GITIGNORE_CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Automatic .gitignore file creation and updates</li>
                            <li>Dry-run mode for preview</li>
                            <li>Repository scanning with exclusion rules</li>
                            <li>Integration with AlephAuto job queue</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ¥ Claude Health Pipeline</h4>
                        <p><strong>Purpose:</strong> Monitors Claude Code environment health and configuration status</p>
                        <p><strong>Schedule:</strong> Daily at 6 AM (HEALTH_CRON_SCHEDULE)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Environment variable validation</li>
                            <li>Dependency health checks</li>
                            <li>Configuration integrity verification</li>
                            <li>Health report generation</li>
                        </ul>
                    </div>
                    <div class="pipeline-doc">
                        <h4>ğŸ§ª Test Refactor Pipeline</h4>
                        <p><strong>Purpose:</strong> Scans test suites and generates modular utility files</p>
                        <p><strong>Schedule:</strong> Sunday at 4 AM (TEST_REFACTOR_CRON)</p>
                        <p><strong>Key Features:</strong></p>
                        <ul>
                            <li>Test pattern detection (renderWaitFor, form interactions)</li>
                            <li>Hardcoded string extraction</li>
                            <li>Duplicate assertion identification</li>
                            <li>Utility file generation with recommendations</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="doc-panel" data-panel="api">
                <h3>API Reference</h3>
                <h4>Endpoints</h4>
                <div class="api-endpoints">
                    <div class="api-endpoint">
                        <code class="http-method">GET</code>
                        <code class="endpoint-path">/health</code>
                        <p>Health check endpoint - returns server status</p>
                    </div>
                    <div class="api-endpoint">
                        <code class="http-method">GET</code>
                        <code class="endpoint-path">/api/status</code>
                        <p>System status including pipeline states and job queue</p>
                    </div>
                    <div class="api-endpoint">
                        <code class="http-method">POST</code>
                        <code class="endpoint-path">/api/scans</code>
                        <p>Trigger a new repository scan</p>
                        <pre>{ "repositoryPath": "/path/to/repo" }</pre>
                    </div>
                    <div class="api-endpoint">
                        <code class="http-method">GET</code>
                        <code class="endpoint-path">/api/scans/:scanId</code>
                        <p>Get scan results by ID</p>
                    </div>
                    <div class="api-endpoint">
                        <code class="http-method">GET</code>
                        <code class="endpoint-path">/ws/status</code>
                        <p>WebSocket connection status and client count</p>
                    </div>
                </div>
                <h4>WebSocket Events</h4>
                <ul>
                    <li><code>job:created</code> - New job added to queue</li>
                    <li><code>job:started</code> - Job execution started</li>
                    <li><code>job:completed</code> - Job finished successfully</li>
                    <li><code>job:failed</code> - Job execution failed</li>
                    <li><code>pipeline:status</code> - Pipeline status update</li>
                </ul>
            </div>
            <div class="doc-panel" data-panel="architecture">
                <h3>System Architecture</h3>
                <h4>AlephAuto Job Queue Framework</h4>
                <pre class="architecture-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SidequestServer (Base)          â”‚
â”‚  - Job queue management             â”‚
â”‚  - Concurrency control              â”‚
â”‚  - Event emission                   â”‚
â”‚  - Sentry integration               â”‚
â”‚  - Retry logic & circuit breaker    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–² extends
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚              â”‚              â”‚              â”‚              â”‚              â”‚
DuplicateDetection   Repomix    SchemaEnhancement GitActivity  PluginManager Gitignore  TestRefactor
    Worker           Worker          Worker        Worker         Worker     Worker       Worker
                </pre>
                <h4>Duplicate Detection Pipeline (7 Stages)</h4>
                <pre class="architecture-diagram">
Stage 1-2 (JavaScript): Repository Scanner â†’ AST-Grep Detector
      â†“ JSON via stdin/stdout
Stage 3-7 (Python): Block Extraction â†’ Semantic Annotation
                  â†’ Duplicate Grouping â†’ Suggestions â†’ Reports
                </pre>
                <h4>Key Components</h4>
                <ul>
                    <li><strong>API Server:</strong> Express REST API with WebSocket support</li>
                    <li><strong>Job Queue:</strong> AlephAuto framework with concurrency control</li>
                    <li><strong>Redis Cache:</strong> Git commit-based result caching (30-day TTL)</li>
                    <li><strong>Sentry:</strong> Error tracking and performance monitoring</li>
                    <li><strong>Event Broadcasting:</strong> WebSocket real-time updates</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 AlephAuto Dashboard | <a href="https://github.com/anthropics/claude-code" target="_blank">Built with Claude Code</a></p>
    </footer>

    <!-- Pipeline Details Panel -->
    <div class="panel-overlay" id="panelOverlay" aria-hidden="true"></div>

    <aside class="details-panel" id="detailsPanel" role="dialog" aria-labelledby="panelTitle" aria-hidden="true">
        <!-- Panel Header -->
        <div class="panel-header">
            <h2 class="panel-title" id="panelTitle">Pipeline Details</h2>
            <button
                class="panel-close"
                id="panelCloseBtn"
                aria-label="Close panel"
                type="button"
            >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Panel Tabs -->
        <div class="panel-tabs" role="tablist">
            <button
                class="panel-tab active"
                id="recentTab"
                role="tab"
                aria-selected="true"
                aria-controls="recentPanel"
                type="button"
            >
                Recent <span class="panel-tab-count" id="recentCount">0</span>
            </button>
            <button
                class="panel-tab"
                id="failedTab"
                role="tab"
                aria-selected="false"
                aria-controls="failedPanel"
                type="button"
            >
                Failed <span class="panel-tab-count" id="failedCount">0</span>
            </button>
            <button
                class="panel-tab"
                id="allTab"
                role="tab"
                aria-selected="false"
                aria-controls="allPanel"
                type="button"
            >
                All <span class="panel-tab-count" id="allCount">0</span>
            </button>
        </div>

        <!-- Panel Content -->
        <div class="panel-content">
            <!-- Recent Jobs Section -->
            <div class="panel-section active" id="recentPanel" role="tabpanel" aria-labelledby="recentTab">
                <div class="panel-loading" id="recentLoading">
                    <div class="panel-spinner"></div>
                    <p>Loading recent jobs...</p>
                </div>
                <div class="panel-job-list" id="recentJobsList" aria-live="polite"></div>
                <div class="panel-empty-state" id="recentEmpty" style="display: none;">
                    <svg class="panel-empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p class="panel-empty-message">No recent jobs</p>
                    <p class="panel-empty-hint">Jobs will appear here when the pipeline runs</p>
                </div>
            </div>

            <!-- Failed Jobs Section -->
            <div class="panel-section" id="failedPanel" role="tabpanel" aria-labelledby="failedTab">
                <div class="panel-loading" id="failedLoading">
                    <div class="panel-spinner"></div>
                    <p>Loading failed jobs...</p>
                </div>
                <div class="panel-job-list" id="failedJobsList" aria-live="polite"></div>
                <div class="panel-empty-state" id="failedEmpty" style="display: none;">
                    <svg class="panel-empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="panel-empty-message">No failed jobs</p>
                    <p class="panel-empty-hint">All jobs completed successfully</p>
                </div>
            </div>

            <!-- All Jobs Section -->
            <div class="panel-section" id="allPanel" role="tabpanel" aria-labelledby="allTab">
                <div class="panel-loading" id="allLoading">
                    <div class="panel-spinner"></div>
                    <p>Loading all jobs...</p>
                </div>
                <div class="panel-job-list" id="allJobsList" aria-live="polite"></div>
                <div class="panel-empty-state" id="allEmpty" style="display: none;">
                    <svg class="panel-empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p class="panel-empty-message">No jobs found</p>
                    <p class="panel-empty-hint">Jobs will appear here when the pipeline runs</p>
                </div>
            </div>
        </div>
    </aside>

    <script src="dashboard.js"></script>
</body>
</html>
